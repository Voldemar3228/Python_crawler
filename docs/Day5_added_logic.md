## üîπ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ

### 1. –í–Ω–µ–¥—Ä–µ–Ω–∏–µ `RetryStrategy`

* –î–æ–±–∞–≤–ª–µ–Ω –º–æ–¥—É–ª—å `retry_strategy.py` –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–≤—Ç–æ—Ä–æ–≤.
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–≤—Ç–æ—Ä–æ–≤** –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö (`TransientError`) —Å:

  * —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º –∑–∞–¥–µ—Ä–∂–∫–∏ (exponential backoff),
  * –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —á–∏—Å–ª–∞ –ø–æ–ø—ã—Ç–æ–∫.
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **callback `on_retry`** –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–≤—Ç–æ—Ä–æ–≤, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∫–∞—Å—Ç–æ–º–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.

### 2. –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫ –≤ `_do_request`

* –û—à–∏–±–∫–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

  * `TransientError` ‚Äî –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 429, 503, —Ç–∞–π–º–∞—É—Ç—ã, —Ä–∞–∑—Ä—ã–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è).
  * `PermanentError` ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 404, 401, 403).
* –î–æ–±–∞–≤–ª–µ–Ω –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –±–ª–æ–∫ —á—Ç–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞:

  * —á—Ç–µ–Ω–∏–µ `bytes` + –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `utf-8` —Å `errors="replace"`.
* –¢–∞–π–º–∞—É—Ç—ã –∏ —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ `TransientError`.
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ñ–∏–∫—Å–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—à–∏–±–æ–∫ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

### 3. –£–ª—É—á—à–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ `fetch_url`

* –î–æ–±–∞–≤–ª–µ–Ω **callback `on_retry`** –ø—Ä—è–º–æ –≤–Ω—É—Ç—Ä–∏ `fetch_url` –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏:

  * —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—à–∏–±–æ–∫ (`stats["errors"]`),
  * —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ–≤—Ç–æ—Ä–æ–≤ (`stats["success_retries"]`),
  * –∑–∞–¥–µ—Ä–∂–µ–∫ –ø–æ–≤—Ç–æ—Ä–æ–≤ (`stats["retry_times"]`).
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `RetryStrategy` –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫.
* –û–±—Ä–∞–±–æ—Ç–∫–∞ `PermanentError` –æ—Ç–¥–µ–ª—å–Ω–æ: **–±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤**, —Å—Ä–∞–∑—É —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ `stats`.
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—Ö–æ–≤ –∏ –Ω–µ—É–¥–∞—á —Å –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.

### 4. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —É–ª—É—á—à–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤

* –ü–µ—Ä–µ–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `@pytest.mark.asyncio`.
* –î–æ–±–∞–≤–ª–µ–Ω **–ª–æ–∫–∞–ª—å–Ω—ã–π aiohttp-—Å–µ—Ä–≤–µ—Ä** –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —Ä–∞–∑–Ω—ã—Ö –∫–æ–¥–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤ –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤:

  * `/200` ‚Äî —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç.
  * `/503` ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∞ retry.
  * `/404` ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è –æ—à–∏–±–∫–∞, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–≤—Ç–æ—Ä–æ–≤.
  * `/timeout` ‚Äî –∏–º–∏—Ç–∞—Ü–∏—è —Ç–∞–π–º–∞—É—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–≤—Ç–æ—Ä–æ–≤.
* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã –≤ —Ç–µ—Å—Ç–∞—Ö:

  * –î–ª—è —Ç–µ—Å—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—à–∏–±–æ–∫ —É–≤–µ–ª–∏—á–µ–Ω `total_timeout`, —á—Ç–æ–±—ã —Å–µ—Ä–≤–µ—Ä —É—Å–ø–µ–≤–∞–ª –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 404/503.
  * –î–ª—è —Ç–µ—Å—Ç–∞ –ø–æ–≤—Ç–æ—Ä–æ–≤ –Ω–∞ —Ç–∞–π–º–∞—É—Ç –æ—Å—Ç–∞–≤–ª–µ–Ω –º–∞–ª–µ–Ω—å–∫–∏–π `total_timeout`, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ RetryStrategy.
* –ü—Ä–æ–≤–µ—Ä–∫–∞ **—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ backoff** —á–µ—Ä–µ–∑ —Ñ–∏–∫—Å–∞—Ü–∏—é –∑–∞–¥–µ—Ä–∂–µ–∫ –≤ callback `on_retry`.
* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—à–∏–±–æ–∫:

  * –£–±–µ–¥–∏–ª–∏—Å—å, —á—Ç–æ **TransientError** –∏ **PermanentError** —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
  * –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–≤—Ç–æ—Ä–æ–≤ –∏ —Å—Ä–µ–¥–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–∫–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã.

### 5. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å

* –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏:

  * —É—Å–ø–µ—à–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã,
  * –æ—à–∏–±–∫–∏ –ø–æ —Ç–∏–ø–∞–º,
  * –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∑–∞–¥–µ—Ä–∂–∫–∏.
* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ñ–∞–π–ª `crawler_report.json`:

  * –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ URL,
  * –û—à–∏–±–∫–∏ –ø–æ —Ç–∏–ø–∞–º,
  * –î–∞–Ω–Ω—ã–µ –ø–æ retry (—É—Å–ø–µ—à–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä—ã, –∑–∞–¥–µ—Ä–∂–∫–∏).

### 6. –£–ª—É—á—à–µ–Ω–∏–µ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏

* –í—Å–µ —Å–µ—Ç–µ–≤—ã–µ –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ `TransientError` –∏–ª–∏ `PermanentError`.
* –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª—å circuit breaker –∏ robots.txt.
* –ú–µ—Ç–æ–¥ `fetch_url` —Ç–µ–ø–µ—Ä—å **–Ω–µ –ª–æ–º–∞–µ—Ç—Å—è** –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏, –Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è.

---


| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç / –§—É–Ω–∫—Ü–∏—è               | –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ                                                                        | –ó–∞—á–µ–º / –¶–µ–ª—å                                                                        |
| --------------------------------- | --------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- |
| **RetryStrategy**                 | –í–≤–µ–¥—ë–Ω —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–≤—Ç–æ—Ä–æ–≤ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff –∏ –ª–∏–º–∏—Ç–æ–º –ø–æ–ø—ã—Ç–æ–∫     | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö, —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Ä—É—á–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ |
|                                   | –î–æ–±–∞–≤–ª–µ–Ω callback `on_retry` –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è                      | –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–±–∏—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö –∏ –∏—Ö –∑–∞–¥–µ—Ä–∂–∫–∞—Ö                       |
| **_do_request**                   | –û—à–∏–±–∫–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è –Ω–∞ `TransientError` –∏ `PermanentError`                          | –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤        |
|                                   | –¢–∞–π–º–∞—É—Ç—ã, —Ä–∞–∑—Ä—ã–≤—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∏ –æ—à–∏–±–∫–∏ —á—Ç–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ `TransientError` | –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Å–µ—Ç–µ–≤—ã–º —Å–±–æ—è–º –∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –¥–∞–Ω–Ω—ã–º                                  |
|                                   | –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ `bytes` –∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `utf-8` —Å `errors="replace"`                | –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–∞–¥–µ–Ω–∏–π –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–µ                                   |
| **fetch_url**                     | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `RetryStrategy` —á–µ—Ä–µ–∑ callback `on_retry`                                  | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤, —Ñ–∏–∫—Å–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—à–∏–±–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä–æ–≤           |
|                                   | PermanentError —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤                                                 | –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –Ω–µ–Ω—É–∂–Ω—ã—Ö –ø–æ–≤—Ç–æ—Ä–æ–≤ –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫                              |
|                                   | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—Ö–æ–≤ –∏ –æ—à–∏–±–æ–∫ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π                                             | –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞—É–¥–∏—Ç–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏ —Ä–∞–±–æ—Ç—ã –∫—Ä–∞—É–ª–µ—Ä–∞                                        |
|                                   | Semaphore + robots.txt + rate limiter                                                   | –ö–æ–Ω—Ç—Ä–æ–ª—å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞ –∏ —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —Å–∞–π—Ç–æ–≤                                    |
| **–¢–µ—Å—Ç—ã (`pytest.mark.asyncio`)** | –õ–æ–∫–∞–ª—å–Ω—ã–π aiohttp-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –∫–æ–¥–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤ –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤                         | –ù–∞–¥—ë–∂–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π                                      |
|                                   | –ü—Ä–æ–≤–µ—Ä–∫–∞ retry –Ω–∞ `/503` –∏ —Ç–∞–π–º–∞—É—Ç                                                      | –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ TransientError –≤—ã–∑—ã–≤–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏                            |
|                                   | –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è retry –Ω–∞ `/404`                                                     | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ PermanentError                                        |
|                                   | –¢–µ—Å—Ç —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ backoff —á–µ—Ä–µ–∑ —Ñ–∏–∫—Å–∞—Ü–∏—é –∑–∞–¥–µ—Ä–∂–µ–∫                                  | –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞ —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∑–∞–¥–µ—Ä–∂–µ–∫ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–∞–º–∏                 |
|                                   | –¢–µ—Å—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—à–∏–±–æ–∫                                                                  | –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –≤—Å–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –∏ —É—Å–ø–µ—à–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä—ã              |
| **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å**      | –õ–æ–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞: —É—Å–ø–µ—Ö–∏, –æ—à–∏–±–∫–∏, –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π                    | –£–¥–æ–±–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –∫—Ä–∞—É–ª–µ—Ä–∞                                                 |
|                                   | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–∞ –≤ `crawler_report.json`                                               | –î–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫, –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö URL –∏ retry-–¥–∞–Ω–Ω—ã—Ö                       |
| **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å**                  | –í—Å–µ —Å–µ—Ç–µ–≤—ã–µ –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è                              | –ö—Ä–∞—É–ª–µ—Ä –Ω–µ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ —Å–±–æ–µ                |

---


## üîπ –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ URL –≤ AsyncCrawler

```
fetch_url(url)
      ‚îÇ
      ‚ñº
 –ü—Ä–æ–≤–µ—Ä–∫–∞ Circuit Breaker (–¥–æ–º–µ–Ω)
      ‚îÇ
      ‚îú‚îÄ –ï—Å–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω ‚Üí fail –∏ return ""
      ‚îÇ
      ‚ñº
 –ü—Ä–æ–≤–µ—Ä–∫–∞ robots.txt + rate limiter
      ‚îÇ
      ‚îú‚îÄ –ï—Å–ª–∏ –∑–∞–ø—Ä–µ—â–µ–Ω–æ ‚Üí fail –∏ return ""
      ‚îÇ
      ‚ñº
 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ callback on_retry –¥–ª—è RetryStrategy
      ‚îÇ
      ‚ñº
 retry_strategy.execute_with_retry(_do_request)
      ‚îÇ
      ‚îú‚îÄ _do_request(url)
      ‚îÇ     ‚îÇ
      ‚îÇ     ‚ñº
      ‚îÇ  async GET request (aiohttp)
      ‚îÇ     ‚îÇ
      ‚îÇ     ‚îú‚îÄ HTTP 429/503/500/Timeout/ServerDisconnected ‚Üí raise TransientError
      ‚îÇ     ‚îÇ       (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è RetryStrategy)
      ‚îÇ     ‚îÇ
      ‚îÇ     ‚îú‚îÄ HTTP 404/401/403 ‚Üí raise PermanentError
      ‚îÇ     ‚îÇ       (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è)
      ‚îÇ     ‚îÇ
      ‚îÇ     ‚îî‚îÄ HTTP 200 ‚Üí –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ body ‚Üí return text
      ‚îÇ
      ‚ñº
RetryStrategy (–ø—Ä–∏ TransientError)
      ‚îÇ
      ‚îú‚îÄ –í—ã—á–∏—Å–ª—è–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É (—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff)
      ‚îú‚îÄ –í—ã–∑—ã–≤–∞–µ—Ç on_retry callback ‚Üí –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ + stats
      ‚îú‚îÄ –ü–æ–≤—Ç–æ—Ä—è–µ—Ç _do_request –¥–æ max_attempts
      ‚îÇ
      ‚ñº
–†–µ–∑—É–ª—å—Ç–∞—Ç:
      ‚îÇ
      ‚îú‚îÄ Success ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç, stats –æ–±–Ω–æ–≤–ª–µ–Ω—ã
      ‚îú‚îÄ PermanentError ‚Üí fail, stats –æ–±–Ω–æ–≤–ª–µ–Ω—ã
      ‚îî‚îÄ TransientError –ø–æ—Å–ª–µ max_attempts ‚Üí fail, stats –æ–±–Ω–æ–≤–ª–µ–Ω—ã
```

---

### üîπ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (`crawler.stats`)

* `errors` ‚Äì —Å–ª–æ–≤–∞—Ä—å —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –æ—à–∏–±–æ–∫ –ø–æ —Ç–∏–ø—É (`TransientError`, `PermanentError`)
* `success_retries` ‚Äì —Å–∫–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –ø–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–æ–≤
* `retry_times` ‚Äì —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–¥–µ—Ä–∂–µ–∫ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–∞–º–∏

---


